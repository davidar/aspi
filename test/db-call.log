>>> #enum country: country_name="Deutschland" country_name_en="Germany" country_code="DEU"
...              | country_name="Srbija"      country_name_en="Serbia"  country_code="SRB"
...              | country_name="Hrvatska"    country_name_en="Croatia" country_code="HRV"
...              | country_name="United States of America" country_name_en="United States of America" country_code="USA"
...              | country_name="Polska"      country_name_en="Poland"  country_code="POL"
...              | country_name="Россия"      country_name_en="Russia"  country_code="RUS"
...              | country_name="España"      country_name_en="Spain"   country_code="ESP"
...              .
--> country(country(1)).
    country(country(1),1).
    country_name("Deutschland",country(1)).
    country_name_en("Germany",country(1)).
    country_code("DEU",country(1)).
    country(country(2)).
    country(country(2),2).
    country_name("Srbija",country(2)).
    country_name_en("Serbia",country(2)).
    country_code("SRB",country(2)).
    country(country(3)).
    country(country(3),3).
    country_name("Hrvatska",country(3)).
    country_name_en("Croatia",country(3)).
    country_code("HRV",country(3)).
    country(country(4)).
    country(country(4),4).
    country_name("United States of America",country(4)).
    country_name_en("United States of America",country(4)).
    country_code("USA",country(4)).
    country(country(5)).
    country(country(5),5).
    country_name("Polska",country(5)).
    country_name_en("Poland",country(5)).
    country_code("POL",country(5)).
    country(country(6)).
    country(country(6),6).
    country_name("Россия",country(6)).
    country_name_en("Russia",country(6)).
    country_code("RUS",country(6)).
    country(country(7)).
    country(country(7),7).
    country_name("España",country(7)).
    country_name_en("Spain",country(7)).
    country_code("ESP",country(7)).
understood.

>>> 
>>> #enum city: city_name="Berlin"      city_country=country(1)
...           | city_name="Belgrade"    city_country=country(2)
...           | city_name="Zagreb"      city_country=country(3)
...           | city_name="New York"    city_country=country(4)
...           | city_name="Los Angeles" city_country=country(4)
...           | city_name="Warsaw"      city_country=country(5)
...           .
--> city(city(1)).
    city(city(1),1).
    city_name("Berlin",city(1)).
    city_country(country(1),city(1)).
    city(city(2)).
    city(city(2),2).
    city_name("Belgrade",city(2)).
    city_country(country(2),city(2)).
    city(city(3)).
    city(city(3),3).
    city_name("Zagreb",city(3)).
    city_country(country(3),city(3)).
    city(city(4)).
    city(city(4),4).
    city_name("New York",city(4)).
    city_country(country(4),city(4)).
    city(city(5)).
    city(city(5),5).
    city_name("Los Angeles",city(5)).
    city_country(country(4),city(5)).
    city(city(6)).
    city(city(6),6).
    city_name("Warsaw",city(6)).
    city_country(country(5),city(6)).
understood.

>>> 
>>> #enum customer: customer_name="Jewelry Store" customer_city=city(4)
...               | customer_name="Bakery"        customer_city=city(1)
...               | customer_name="Café"          customer_city=city(1)
...               | customer_name="Restaurant"    customer_city=city(3)
...               .
--> customer(customer(1)).
    customer(customer(1),1).
    customer_name("Jewelry Store",customer(1)).
    customer_city(city(4),customer(1)).
    customer(customer(2)).
    customer(customer(2),2).
    customer_name("Bakery",customer(2)).
    customer_city(city(1),customer(2)).
    customer(customer(3)).
    customer(customer(3),3).
    customer_name("Café",customer(3)).
    customer_city(city(1),customer(3)).
    customer(customer(4)).
    customer(customer(4),4).
    customer_name("Restaurant",customer(4)).
    customer_city(city(3),customer(4)).
understood.

>>> 
>>> #enum employee: first_name="Thomas" last_name="Anderson"
...               | first_name="Agent"  last_name="Smith".
--> employee(employee(1)).
    employee(employee(1),1).
    first_name("Thomas",employee(1)).
    last_name("Anderson",employee(1)).
    employee(employee(2)).
    employee(employee(2),2).
    first_name("Agent",employee(2)).
    last_name("Smith",employee(2)).
understood.

>>> 
>>> #enum outcome: outcome_text="call started"
...              | outcome_text="finished successfully"
...              | outcome_text="finished unsuccessfully".
--> outcome(outcome(1)).
    outcome(outcome(1),1).
    outcome_text("call started",outcome(1)).
    outcome(outcome(2)).
    outcome(outcome(2),2).
    outcome_text("finished successfully",outcome(2)).
    outcome(outcome(3)).
    outcome(outcome(3),3).
    outcome_text("finished unsuccessfully",outcome(3)).
understood.

>>> 
>>> call_employee.C: employee(csv[C,1]).
--> call_employee(employee(A),MuC) :- csv(A,MuC,1).
understood.

>>> call_customer.C: customer(csv[C,2]).
--> call_customer(customer(A),MuC) :- csv(A,MuC,2).
understood.

>>> start_time.C: csv[C,3].
--> start_time(A,MuC) :- csv(A,MuC,3).
understood.

>>> end_time.C: csv[C,4].
--> end_time(A,MuC) :- csv(A,MuC,4).
understood.

>>> call_outcome.C: outcome(csv[C,5]).
--> call_outcome(outcome(A),MuC) :- csv(A,MuC,5).
understood.

>>> 
>>> duration.C: end_time.C - start_time.C.
--> duration(A-B,MuC) :- end_time(A,MuC), start_time(B,MuC).
understood.

>>> 
>>> % SELECT employee.first_name, employee.last_name, call.start_time, call.end_time, call_outcome.outcome_text
>>> % FROM employee
>>> % INNER JOIN call ON call.employee_id = employee.id
>>> % INNER JOIN call_outcome ON call.call_outcome_id = call_outcome.id
>>> % ORDER BY call.start_time ASC;
>>> row(start_time.C, end_time.C, first_name.E, last_name.E, outcome_text.call_outcome.C) :- E = call_employee.C?
--> what(row(A,B,C,D,F)) :- start_time(A,MuC), end_time(B,MuC), first_name(C,MuE), last_name(D,MuE), outcome_text(F,E), call_outcome(E,MuC), MuE = G, call_employee(G,MuC).
that: row(15,1222,"Thomas","Anderson","finished successfully")
    | row(220,1805,"Agent","Smith","finished unsuccessfully")
    | row(1450,2001,"Thomas","Anderson","finished successfully")
    | row(2415,2505,"Thomas","Anderson","finished unsuccessfully")
    | row(2623,3345,"Thomas","Anderson","finished successfully")
    | row(4031,4232,"Thomas","Anderson","finished successfully")
    | row(4117,4521,"Agent","Smith","finished successfully")
    | row(4232,4653,"Thomas","Anderson","finished unsuccessfully")
    | row(4600,4802,"Agent","Smith","finished successfully")
    | row(5012,5535,"Agent","Smith","finished successfully").

>>> 
>>> % SELECT country.country_name_eng, city.city_name, customer.customer_name
>>> % FROM country
>>> % INNER JOIN city ON city.country_id = country.id
>>> % INNER JOIN customer ON customer.city_id = city.id;
>>> row(country_name_en.city_country.X, city_name.X, customer_name.customer_city=X)?
--> what(row(B,C,E)) :- country_name_en(B,A), city_country(A,MuX), city_name(C,MuX), customer_name(E,D), customer_city(MuX,D).
that: row("Croatia","Zagreb","Restaurant")
    | row("Germany","Berlin","Bakery")
    | row("Germany","Berlin","Café")
    | row("United States of America","New York","Jewelry Store").

>>> 
>>> % SELECT country.country_name_eng, city.city_name, customer.customer_name
>>> % FROM country
>>> % INNER JOIN city ON city.country_id = country.id
>>> % LEFT JOIN customer ON customer.city_id = city.id;
>>> row(country_name_en.city_country.X, city_name.X, customer_name.customer_city=X || null)?
--> what(row(B,C,G)) :- country_name_en(B,A), city_country(A,MuX), city_name(C,MuX), disjunction((1,MuX),G).
    negation((2,MuX),0) :- customer_name(E,D), customer_city(MuX,D), null(F), country_name_en(B,A), city_country(A,MuX), city_name(C,MuX).
    disjunction((1,MuX),E) :- customer_name(E,D), customer_city(MuX,D), country_name_en(B,A), city_country(A,MuX), city_name(C,MuX).
    disjunction((1,MuX),F) :- not negation((2,MuX),0), null(F), country_name_en(B,A), city_country(A,MuX), city_name(C,MuX).
that: row("Croatia","Zagreb","Restaurant")
    | row("Germany","Berlin","Bakery")
    | row("Germany","Berlin","Café")
    | row("Poland","Warsaw",null)
    | row("Serbia","Belgrade",null)
    | row("United States of America","Los Angeles",null)
    | row("United States of America","New York","Jewelry Store").

>>> 
>>> % SELECT country.country_name_eng, city.city_name, customer.customer_name
>>> % FROM country
>>> % LEFT JOIN city ON city.country_id = country.id
>>> % LEFT JOIN customer ON customer.city_id = city.id;
>>> row(country_name_en.C, city_name.city_country=C || null, customer_name.customer_city=city_country=C || null)?
--> what(row(A,E,J)) :- country_name_en(A,MuC), disjunction((2,MuC),E), disjunction((3,MuC),J).
    negation((3,MuC),0) :- city_name(C,B), city_country(MuC,B), null(D), country_name_en(A,MuC).
    disjunction((2,MuC),C) :- city_name(C,B), city_country(MuC,B), country_name_en(A,MuC).
    disjunction((2,MuC),D) :- not negation((3,MuC),0), null(D), country_name_en(A,MuC).
    negation((4,MuC),0) :- customer_name(H,G), customer_city(F,G), city_country(MuC,F), null(I), country_name_en(A,MuC).
    disjunction((3,MuC),H) :- customer_name(H,G), customer_city(F,G), city_country(MuC,F), country_name_en(A,MuC).
    disjunction((3,MuC),I) :- not negation((4,MuC),0), null(I), country_name_en(A,MuC).
that: row("Croatia","Zagreb","Restaurant")
    | row("Germany","Berlin","Bakery")
    | row("Germany","Berlin","Café")
    | row("Poland","Warsaw",null)
    | row("Russia",null,null)
    | row("Serbia","Belgrade",null)
    | row("Spain",null,null)
    | row("United States of America","Los Angeles","Jewelry Store")
    | row("United States of America","New York","Jewelry Store").

>>> 
>>> % SELECT country.country_name_eng, COUNT(city.city_name) AS city_count
>>> % FROM country
>>> % INNER JOIN city ON city.country_id = country.id
>>> % GROUP BY country.id, country.country_name_eng;
>>> row(country_name_en.C, count{city_name.city_country=C})?
--> what(row(A,E)) :- country_name_en(A,MuC), E = @countof(D), setof((1,MuC),D).
    gather_index((1,MuC)) :- country_name_en(A,MuC).
    gather((1,MuC),C) :- city_name(C,B), city_country(MuC,B), country_name_en(A,MuC).
that: row("Croatia",1) | row("Germany",1) | row("Poland",1) | row("Russia",0) | row("Serbia",1) | row("Spain",0) | row("United States of America",2).

>>> 
>>> % SELECT country.country_name_eng,
>>> %        SUM(CASE WHEN call.id IS NOT NULL THEN 1 ELSE 0 END) AS calls,
>>> %        SUM(ISNULL(DATEDIFF(SECOND, call.start_time, call.end_time),0)) AS total_duration_country
>>> % FROM country 
>>> % LEFT JOIN city ON city.country_id = country.id
>>> % LEFT JOIN customer ON city.id = customer.city_id
>>> % LEFT JOIN call ON call.customer_id = customer.id
>>> % GROUP BY country.id, country.country_name_eng
>>> % HAVING SUM(ISNULL(DATEDIFF(SECOND, call.start_time, call.end_time),0)) >
>>> %        (SELECT SUM(DATEDIFF(SECOND, call.start_time, call.end_time)) / 4 FROM call)
>>> % ORDER BY calls ASC, country.id ASC;
>>> country_calls.C: call_customer=customer_city=city_country=C.
--> country_calls(C,MuC) :- call_customer(B,C), customer_city(A,B), city_country(MuC,A).
understood.

>>> total_duration_country[country C]: sum{duration.country_calls.C}.
--> total_duration_country(E,A) :- country(A), A = MuC, E = @sumof(D), setof((2,MuC),D).
    gather_index((2,MuC)) :- country(A), A = MuC.
    gather((2,MuC),C) :- duration(C,B), country_calls(B,MuC), country(A), A = MuC.
understood.

>>> total_duration: sum{duration.country_calls.country}.
--> total_duration(E) :- E = @sumof(D), setof((3),D).
    gather((3),C) :- duration(C,B), country_calls(B,A), country(A).
understood.

>>> row(count{country_calls.C} || 0, C, country_name_en.C, total_duration_country.C (> total_duration/4))?
--> what(row(D,MuC,E,G)) :- disjunction((4,MuC),D), country_name_en(E,MuC), total_duration_country(G,MuC), G > F/4, total_duration(F).
    gather_index((4,MuC)) :- country_name_en(E,MuC), total_duration_country(G,MuC), total_duration(F).
    gather((4,MuC),A) :- country_calls(A,MuC), country_name_en(E,MuC), total_duration_country(G,MuC), total_duration(F).
    negation((5,MuC),0) :- C = @countof(B), setof((4,MuC),B), country_name_en(E,MuC), total_duration_country(G,MuC), total_duration(F).
    disjunction((4,MuC),C) :- C = @countof(B), setof((4,MuC),B), country_name_en(E,MuC), total_duration_country(G,MuC), total_duration(F).
    disjunction((4,MuC),0) :- not negation((5,MuC),0), country_name_en(E,MuC), total_duration_country(G,MuC), total_duration(F).
that: row(2,country(3),"Croatia",1611)
    | row(5,country(1),"Germany",3582).

>>> thanks.
YOU'RE WELCOME!
